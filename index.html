<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Math Calc Game</title>
<style>
    img {
        width: 100px;
        border-radius: 50px; 
        margin-top: 15px;
        object-fit: cover;
    }

    body { font-family: Arial, sans-serif; text-align: center; background: #f5f5f5; }
    .container { margin-top: 40px; }
    .hidden { display: none; }
    input, select, button { padding: 8px; margin: 5px; font-size: 16px; }
    #question { font-size: 28px; margin: 20px; }
    #timer { font-weight: bold; }
    .result-box { background: white; padding: 20px; display: inline-block; border-radius: 10px; }
    .btn-red { background-color: red; color: white; padding: 10px 20px; font-size: 16px; border: none; border-radius: 5px; margin-top: 10px; cursor: pointer;}
    .btn-gray { background-color: skyblue; color: white; padding: 10px 20px; font-size: 16px; border: none; border-radius: 5px; margin-top: 10px; cursor: pointer;}
    table { margin: 20px auto; border-collapse: collapse; width: 90%; max-width: 800px; background: white; }
    th, td { border: 1px solid #ddd; padding: 10px; text-align: center; }
    th { background: #f0f0f0; }
</style>
</head>
<body>

<img src="photo.jpg" alt="Harinath">

<div class="container" id="setupScreen">
  <h1>MATHS CALC GAME</h1>
  <h3>POINTS DISTRIBUTION</h3>
  <h4>Easy - 10 |  Medium - 25 |  Hard - 200</h4> 
  <h4>Pro - 500   |    Legend - 1000</h4>

  <p>Enter your Name, select difficulty, and start the challenge!</p>
  

  <label>Name:</label>
  <input type="text" id="userId" placeholder="Name"><br>

  <label>Difficulty:</label>
  <select id="difficulty">
    <option value="easy">Easy</option>
    <option value="medium">Medium</option>
    <option value="hard">Hard</option>
    <option value="pro">Pro</option>
    <option value="legend">Legend</option>
  </select><br>

  <label>Time (minutes):</label>
  <input type="number" id="time" placeholder="e.g. 2"><br>

  <button onclick="startGame()" style="background-color: skyblue; color: red; font-weight: bold;">START</button>
</div>

<div class="container hidden" id="gameScreen">
  <h3 id="timer">Time: 0s</h3>
  <div id="question"></div>
  <input type="number" id="answer" placeholder="Enter your answer" step="any"><br>
  <button class="btn-red" onclick="submitAnswer()">Submit</button>
  <button class="btn-gray" onclick="skipQuestion()">Skip</button>
  <p id="feedback"></p>
</div>

<div class="container hidden" id="resultScreen">
  <div class="result-box">
    <h2>üßæ Results</h2>
    <p id="userInfo"></p>
    <p id="totalQ"></p>
    <p id="correctQ"></p>
    <p id="wrongQ"></p>
    <p id="skippedQ"></p>
    <p id="accuracy"></p>
    <p id="points"></p>
    <p id="avgTime"></p>
    <button onclick="showMistakes()">Show Wrong Answers</button>
    <button onclick="restart()">QUIT</button>
  </div>
</div>

<div class="container" id="leaderboardSection">
  <h2>üèÜ Leaderboard</h2>
  <table id="leaderboardTable">
    <thead>
      <tr>
        <th>User ID</th>
        <th>Mode</th>
        <th>Time</th>
        <th>Accuracy (%)</th>
        <th>Points</th>
        <th>Total Points</th>
      </tr>
    </thead>
    <tbody id="leaderboardBody"></tbody>
  </table>
</div>

<script>
let timerInterval, remainingTime;
let correct = 0, wrong = 0, total = 0, skipped = 0, startTime;
let currentAnswer, currentQuestion;
let userId, difficulty, timeMin;
let mistakes = [];

const modePoints = { easy: 10, medium: 50, hard: 200, pro: 500, legend: 1000 };

function startGame() {
  userId = document.getElementById("userId").value.trim();
  difficulty = document.getElementById("difficulty").value;
  timeMin = document.getElementById("time").value;

  if (!userId) { alert("Please enter your Name!"); return; }
  if (!timeMin) { alert("Please enter time!"); return; }

  const existingData = JSON.parse(localStorage.getItem("leaderboard") || "[]");
  // if (existingData.some(x => x.userId === userId)) {
  //   alert("This ID already exists. Please choose a different one.");
  //   return;
  // }

  document.getElementById("setupScreen").classList.add("hidden");
  document.getElementById("gameScreen").classList.remove("hidden");
  document.getElementById("leaderboardSection").classList.add("hidden");

  remainingTime = parseInt(timeMin) * 60;
  startTime = new Date();

  startTimer();
  nextQuestion(difficulty);
}

function startTimer() {
  const timerDisplay = document.getElementById("timer");
  timerDisplay.textContent = `Time: ${remainingTime}s`;

  timerInterval = setInterval(() => {
    remainingTime--;
    timerDisplay.textContent = `Time: ${remainingTime}s`;
    if (remainingTime <= 0) endGame();
  }, 1000);
}

function nextQuestion(difficulty) {
  document.getElementById("answer").value = "";
  document.getElementById("feedback").textContent = "";

  const [min, max] = getRange(difficulty);
  let questionText, answer;

  const type = rand(0, 4);
  let n1 = rand(min, max), n2 = rand(min, max);

  switch (type) {
    case 0: questionText = `${n1} + ${n2}`; answer = n1 + n2; break;
    case 1: if (n2 > n1) [n1, n2] = [n2, n1]; questionText = `${n1} - ${n2}`; answer = n1 - n2; break;
    case 2: questionText = `${n1} √ó ${n2}`; answer = n1 * n2; break;
    case 3: case 3: // Division (show integer √∑ integer, but answer can be decimal)
  n1 = rand(min, max);
  n2 = rand(2, 9);
  questionText = `${n1} √∑ ${n2}`;
  answer = parseFloat((n1 / n2).toFixed(2)); // store up to 2 decimals
  break;

    case 4: const sq = rand(min, max); questionText = `‚àö${sq * sq}`; answer = sq; break;
  }

  currentQuestion = questionText;
  currentAnswer = answer;
  document.getElementById("question").textContent = questionText;
}

function submitAnswer() {
  const userAns = parseFloat(document.getElementById("answer").value);
  if (isNaN(userAns)) return;

  total++;
  const correctAns = Math.round(currentAnswer * 100) / 100;
  const userRounded = Math.round(userAns * 100) / 100;

  if (Math.abs(userAns.toFixed(2) - currentAnswer.toFixed(2)) < 0.02) {

    correct++;
    document.getElementById("feedback").textContent = "Correct!";
  } else {
    wrong++;
    document.getElementById("feedback").textContent = `Wrong! (Correct: ${correctAns})`;
    mistakes.push({ q: currentQuestion, correct: correctAns, user: userRounded });
  }

  nextQuestion(difficulty);
}

function skipQuestion() {
  total++;
  skipped++;
  document.getElementById("feedback").textContent = `‚è≠Skipped! (Correct: ${currentAnswer})`;
  nextQuestion(difficulty);
}

function endGame() {
  clearInterval(timerInterval);
  document.getElementById("gameScreen").classList.add("hidden");
  document.getElementById("resultScreen").classList.remove("hidden");
  document.getElementById("leaderboardSection").classList.remove("hidden");

  const elapsedTime = (new Date() - startTime) / 1000;
  const answered = total - skipped;
  const avgTime = answered > 0 ? (elapsedTime / answered).toFixed(2) : 0;
  const accuracy = answered > 0 ? ((correct / answered) * 100).toFixed(2) : 0;
  const points = correct * modePoints[difficulty];

  document.getElementById("userInfo").textContent = `User ID: ${userId} | Mode: ${difficulty} | Time: ${timeMin} min`;
  document.getElementById("totalQ").textContent = `Total Questions: ${total}`;
  document.getElementById("correctQ").textContent = `Correct: ${correct}`;
  document.getElementById("wrongQ").textContent = `Wrong: ${wrong}`;
  document.getElementById("skippedQ").textContent = `Skipped: ${skipped}`;
  document.getElementById("accuracy").textContent = `Accuracy: ${accuracy}%`;
  document.getElementById("points").textContent = `Points: ${points}`;
  document.getElementById("avgTime").textContent = `Avg Time/Answered Q: ${avgTime}s`;

  saveToLeaderboard(userId, difficulty, timeMin, accuracy, points);
}

function showMistakes() {
  if (mistakes.length === 0) {
    alert("No mistakes! üéâ");
    return;
  }
  let msg = "Your Mistakes:\n\n";
  mistakes.forEach((m, i) => {
    msg += `${i + 1}. ${m.q}\nYour Answer: ${m.user} | Correct: ${m.correct}\n\n`;
  });
  alert(msg);
}

function saveToLeaderboard(userId, mode, time, accuracy, points) {
  let leaderboard = JSON.parse(localStorage.getItem("leaderboard") || "[]");
  let existing = leaderboard.find(u => u.userId === userId);

  if (existing) {
    existing.totalPoints += points;
  } else {
    existing = { userId, mode, time, accuracy, points, totalPoints: points };
    leaderboard.push(existing);
  }

  localStorage.setItem("leaderboard", JSON.stringify(leaderboard));
  updateLeaderboard();
}

function updateLeaderboard() {
  let leaderboard = JSON.parse(localStorage.getItem("leaderboard") || "[]");
  leaderboard.sort((a, b) => b.totalPoints - a.totalPoints);
  const body = document.getElementById("leaderboardBody");
  body.innerHTML = "";
  leaderboard.forEach(u => {
    const row = `<tr>
      <td>${u.userId}</td>
      <td>${u.mode}</td>
      <td>${u.time} min</td>
      <td>${u.accuracy}</td>
      <td>${u.points}</td>
      <td>${u.totalPoints}</td>
    </tr>`;
    body.innerHTML += row;
  });
}

function restart() {
  location.reload();
}

function rand(min, max) { return Math.floor(Math.random() * (max - min + 1)) + min; }

function getRange(difficulty) {
  switch (difficulty) {
    case "easy": return [1, 10];
    case "medium": return [10, 100];
    case "hard": return [100, 1000];
    case "pro": return [1000, 10000];
    case "legend": return [10000, 100000];
  }
}

function getCleanDivision(min, max) {
  let a, b;
  for (let i = 0; i < 100; i++) {
    a = rand(min, max);
    b = rand(2, 9);
    if (a % b === 0 || b < 10) break;
  }
  return [a, b];
}

// Initial load leaderboard
updateLeaderboard();
</script>

</body>
</html>
